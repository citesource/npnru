<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>NPNRU</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="shortcut icon" type="image/png" href="img/logo_anru-01.png"/>
	<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
	<link rel="stylesheet" href="src/leaflet-search.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="//cdn.leafletjs.com/leaflet-0.7.2/leaflet.ie.css" /><![endif]-->

    <link rel="stylesheet" href="src/leaflet-sidebar.css" />
	<link rel="stylesheet" href="style.css" />
	
</head>

<body>
    <div id="sidebar" class="sidebar collapsed">
        <!-- Nav tabs -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                <li><a href="#home" role="tab" id="logo_acv"><i class="fa"><img src="img/logo_anru-01.png" style="width:30px;padding:5px"  /></i></a></li>
                <li><a href="https://www.cget.gouv.fr" role="tab" target="_blank" title="Retour sur le site du CGET"><img src="img/logo_cget.png" /></a></li>
				<li><a href="img/Carte_NPNRU_France.pdf" role="tab" target="_blank" title="Télécharger la carte"><i class="fa fa-download"></i></a></li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            <div class="sidebar-pane" id="home">
                <h1 class="sidebar-header">
                    NPNRU
                    <span class="sidebar-close" id="close"><i class="fa fa-caret-left"></i></span>
                </h1>
				
				<div class="presentation" id="defaut">
					<h1>Nouveau Programme National de Renouvellement Urbain</h1>
					
					<p class="petit">Cliquer sur un quartier pour avoir plus d'infos ou cliquer sur la légende pour idenfier un type de quartier sur la carte</p>
					<h2>Quartiers prioritaires de la politique de la ville bénéficiant du NPNRU</h2>
					<h3 id="bouton-int-nat-titre" class="bouton">216 quartiers d'intérêt national</h3>
					<div class="bouton" id="bouton-int-nat-val"><img id="picto_nat" src="img/pictos_leg_national_val_off.png" style="width:17px; padding-right:5px; vertical-align:middle;" />Projet validé</div>
					<div class="bouton" id="bouton-int-nat"><img id="picto_reg" src="img/pictos_leg_national_off.png" style="width:17px; padding-right:5px; vertical-align:middle;" />Projet non validé</div>
					<h3>264 quartiers d'intérêt régional</h3>
					<div class="bouton" id="bouton-int-reg"><img id="picto_reg" src="img/pictos_leg_regional_off.png" style="width:17px; padding-right:5px; vertical-align:middle;" />Quartier d'intérêt régional</div>
					<br/>
					<h2>Le nouveau programme de renouvellement urbain</h2>
					<p class="lorem">Lancé en 2014, le nouveau programme national de renouvellement urbain (NPNRU) concerne <strong>480 quartiers prioritaires : 216 d’intérêt national et 264 d’intérêt régional</strong>, où vivent environ <strong>trois millions d’habitants</strong>. Ce programme porte sur des quartiers de grandes métropoles, des villes moyennes, de grands ensembles d’habitat social ou des immeubles dans les centres anciens dégradés, situés dans l’Hexagone et en outre-mer.</p>
					<p class="lorem">À travers de vastes projets urbains, le NPNRU consiste à améliorer l’habitat, à repenser, à transformer et à réaménager les espaces et équipements collectifs de ces quartiers en les connectant à la ville, notamment par une meilleure desserte en transports, à y installer des commerces et des activités d’entreprise, dans un souci d’amélioration du cadre de vie et de mixité sociale.</p>
					<p class="lorem">L’Agence nationale de la rénovation urbaine (Anru), chargée de la mise en œuvre du NPNRU, dispose désormais de 10 milliards d’euros pour le soutien financier des projets présentés par les collectivités. Au total, <strong>40 milliards d’euros</strong> seront investis dans ces 480 quartiers pour des opérations de démolition et de reconstitution de logements sociaux, d’aménagement d’espaces publics ou bien encore de traitement des copropriétés dégradées.</p>
					<p class="lorem">Les projets du NPNRU doivent être élaborés en impliquant les habitants des quartiers, à travers les conseils citoyens notamment, aux différentes étapes du projet de transformation de leur quartier.</p>
					<br/>
					<p><i>Sources : <a href="https://www.anru.fr/fre/Programmes/Nouveau-Programme-National-de-Renouvellement-Urbain" style="text-decoration:none;" target="_blanck ">ANRU 2018, </a><a href="http://www.onpv.fr/" style="text-decoration:none;" target="_blanck ">ONPV</a> • Réalisation : <a href="http://www.cget.gouv.fr/ressources/cartotheque" style="text-decoration:none;" target="_blanck ">CGET service cartographie</a> • Dernière mise à jour : 25 octobre 2018</i></p>
				</div>

				<div id="popup">
					<h1 id="libgeo"></h1>
					<h2 id="quartier"></h2>
					<p id="interet" ></p> 
					<p id="date" ></p>
					<p id="epci" ></p>
					<p id="region"></p>
					<p id="plus"></p>					
				</div>
				
            </div>

            <div class="sidebar-pane" id="profile">
                <h1 class="sidebar-header">Profile<span class="sidebar-close"><i class="fa fa-caret-left"></i></span></h1>
            </div>

        </div>
    </div>


	<div id="mapid" class="sidebar-map"></div>
	
    <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js"></script>
	<script src="src/leaflet-search.js"></script>
    <script src="https://turbo87.github.io/sidebar-v2/js/leaflet-sidebar.js"></script>
	<script type="text/javascript" src="data/masque.js"></script>
	<script type="text/javascript" src="data/departements.js"></script>
	<script type="text/javascript" src="data/regions.js"></script>
	<script type="text/javascript" src="data/npnru_p.js"></script>
	<script type="text/javascript" src="data/cercles_drom.js"></script>
	
	
    <script>
		
			
		// Création de la carte
		var map = L.map('mapid', {maxZoom:11, minZoom:6 
		})
		.setView([46.5, 2], 6);
		map.zoomControl.setPosition('topright');
		
		//Définition des pictos
		var	regional_off = new L.Icon({iconUrl: 'img/pictos_regional_off.png', iconSize: [14,14], iconAnchor:[7,7]}),
			regional_on = new L.Icon({iconUrl: 'img/pictos_regional_on.png', iconSize: [23,23], iconAnchor:[11.5,11.5]}),
			national_off = new L.Icon({iconUrl: 'img/pictos_national_off.png', iconSize: [17,17], iconAnchor:[7.8,7.8]}),
			national_on = new L.Icon({iconUrl: 'img/pictos_national_on.png', iconSize: [25,25], iconAnchor:[12.5,12.5]}),
			national_val_off = new L.Icon({iconUrl: 'img/pictos_national_val_off.png', iconSize: [19,19], iconAnchor:[9.5,9.5]}),
			national_val_on = new L.Icon({iconUrl: 'img/pictos_national_val_on.png', iconSize: [27,27], iconAnchor:[13.5,13.5]});
			
		/* Choix du fond de carte 
		var GeoportailFrance_parcels = L.tileLayer('https://wxs.ign.fr/{apikey}/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE={style}&TILEMATRIXSET=PM&FORMAT={format}&LAYER=CADASTRALPARCELS.PARCELS&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}', {
		apikey: 'choisirgeoportail',
		attribution: '<a target="_blank" href="https://www.cget.gouv.fr/ressources/cartotheque">CGET</a>',
		format: 'image/png',
		style: 'bdparcellaire'
		});*/
		
		var GeoportailFrance_parcels = L.tileLayer('https://wxs.ign.fr/{apikey}/geoportail/wmts?REQUEST=GetTile&SERVICE=WMTS&VERSION=1.0.0&STYLE={style}&TILEMATRIXSET=PM&FORMAT={format}&LAYER=CADASTRALPARCELS.PARCELS&TILEMATRIX={z}&TILEROW={y}&TILECOL={x}', {
		attribution: '<a target="_blank" href="https://www.geoportail.gouv.fr/">Geoportail France</a>',
		bounds: [[-75, -180], [81, 180]],
		minZoom: 2,
		maxZoom: 20,
		apikey: 'choisirgeoportail',
		format: 'image/png',
		style: 'bdparcellaire'
		});
		
		GeoportailFrance_parcels.addTo(map);
		
		//Ajout des couches du fond de carte
		//Cache = L.geoJSON(JS_masque, {color: "#f0f1ff", weight: 0, opacity: 1, fillOpacity: 1}).addTo(map);
		Fond_Regions = L.geoJSON(JS_reg, {weight: 0, opacity: 1, fillOpacity: 0.2, fillColor:"#a8bdff"}).addTo(map);
		Contour_Regions = L.geoJSON(JS_reg, {color: "#ffffff", weight: 2, opacity: 1, fillOpacity: 0}).addTo(map);
		Cercles_drom = L.geoJSON(JS_drom, {color: "#ffffff", weight: 2, opacity: 0.7, fillOpacity: 0}).addTo(map);
		Departements = L.geoJSON(JS_dep, {
			style:{color: "#ffffff", weight: 1, opacity: 1, fillOpacity: 0}
		}).addTo(map);
		
		// Action au clic sur un marker
		var markerSelectionne;
		var color="ac003f";
		
		function infos(e) {
		//console.log(e);
			if (document.getElementById('sidebar').classList.contains('collapsed')){
				sidebar.open('home');
				if (map.getZoom() < 8) {map.setView([46.5, -3], 6);}
				}
			if(markerSelectionne){
				if (markerSelectionne.feature.properties.INTERET == "national" && markerSelectionne.feature.properties.VALIDE == "oui") {markerSelectionne.setIcon(national_val_off);}
				else if (markerSelectionne.feature.properties.INTERET == "regional"){markerSelectionne.setIcon(regional_off);}
				else {markerSelectionne.setIcon(national_off);};
				}
			
			markerSelectionne = e.target;
			
			if (markerSelectionne.feature.properties.INTERET == "national" && markerSelectionne.feature.properties.VALIDE == "oui") {
				markerSelectionne.setIcon(national_val_on);
				 color="ff6400";
				}
			else if (markerSelectionne.feature.properties.INTERET == "regional"){markerSelectionne.setIcon(regional_on);color="ac003f";}
			else {markerSelectionne.setIcon(national_on); color="ff6400";};
			
			document.getElementById('popup').style.display = "block";
			document.getElementById('defaut').style.display = "none";
			document.getElementById('date').style.display = "none";
			document.getElementById('libgeo').innerHTML = e.target.feature.properties.COMMUNE_QP+" ("+e.target.feature.properties.DEP+")";
			document.getElementById('quartier').innerHTML = "Quartier <font color='#"+color+"'>"+e.target.feature.properties.NOM_QP+"</font>";
			document.getElementById('epci').innerHTML = "Intercommunalité(s) signataire(s) : <strong>"+e.target.feature.properties.libgeo;
			document.getElementById('region').innerHTML = "Région <strong>"+e.target.feature.properties.NREG+"</strong>";
			document.getElementById('interet').innerHTML = "Quartier d'intérêt <strong><font color='#"+color+"'>"+e.target.feature.properties.INTERET+"</font></strong>";
			if(markerSelectionne.feature.properties.VALIDE == "oui") {
				document.getElementById('date').innerHTML = "Projet validé : <strong>"+e.target.feature.properties.VALIDATION+"</strong>";
				document.getElementById('date').style.display = "block";
				}
			document.getElementById('plus').innerHTML = "<a href='https://sig.ville.gouv.fr/Territoire/"+e.target.feature.properties.CODE_QP+"' title='Site du SIG ville' style='text-decoration:none;' target='_blanck'>&rarr; En savoir plus sur ce quartier</a>";
		}
		
		//Création de la sidebar
		var sidebar = L.control.sidebar('sidebar').addTo(map);
		
		//Ajout des couches NPNRU
		NPNRU_reg = L.geoJSON(JS_npnru_P, {
				pointToLayer: function(feature, latlng) {
					return L.marker(latlng,{icon:regional_off}).on('click', function(e) { infos(e);})
					},
				filter : function(feature, layer) {
					return feature.properties.INTERET == "regional";
					},
				onEachFeature : function(feature, layer) {
					layer.bindTooltip(feature.properties.COMMUNE_QP, {className: 'TooltipsREG', closeButton: false});
					}
		}).addTo(map)
		
		NPNRU_nat = L.geoJSON(JS_npnru_P, {
				pointToLayer: function(feature, latlng) {
					return L.marker(latlng,{icon:national_off}).on('click', function(e) { infos(e);})
				},
				filter : function(feature, layer) {
                return feature.properties.INTERET == "national" && (feature.properties.VALIDE == "non" || feature.properties.VALIDE == "inconnu")  ;
				},
				onEachFeature : function(feature, layer) {
					layer.bindTooltip(feature.properties.COMMUNE_QP, {className: 'TooltipsNAT', closeButton: false});
					}
		}).addTo(map)
		
		NPNRU_nat_val = L.geoJSON(JS_npnru_P, {
				pointToLayer: function(feature, latlng) {
					return L.marker(latlng,{icon:national_val_off}).on('click', function(e) { infos(e);})
				},
				filter : function(feature, layer) {
                return feature.properties.INTERET == "national" && feature.properties.VALIDE == "oui";
				},
				onEachFeature : function(feature, layer) {
					layer.bindTooltip(feature.properties.COMMUNE_QP, {className: 'TooltipsNAT', closeButton: false});
					}
		}).addTo(map)
		
		//Events au clic sur la carte
		map.on('click', function(e) {  
			document.getElementById('bouton-int-reg').setAttribute("class", "bouton");
			document.getElementById('bouton-int-nat-val').setAttribute("class", "bouton");
			document.getElementById('bouton-int-nat').setAttribute("class", "bouton");
			document.getElementById('popup').style.display = "none";
			document.getElementById('defaut').style.display = "block";   
			map.addLayer(NPNRU_reg); 
			map.addLayer(NPNRU_nat); 
			map.addLayer(NPNRU_nat_val);
			if(map.getZoom() < 8){
			if (document.getElementById('sidebar').classList.contains('collapsed')) {
				sidebar.open('home');
				map.panTo([46.5, -3],{duration: 0.5 });
			}}
		});
		
		document.getElementById("sidebar").addEventListener("click", function(){
			document.getElementById('bouton-int-reg').setAttribute("class", "bouton");
			document.getElementById('bouton-int-nat').setAttribute("class", "bouton");
			document.getElementById('bouton-int-nat-val').setAttribute("class", "bouton");
			document.getElementById('popup').style.display = "none";
			document.getElementById('defaut').style.display = "block";   
			map.addLayer(NPNRU_reg); 
			map.addLayer(NPNRU_nat);
			map.addLayer(NPNRU_nat_val);			
		});
		
		//Carte qui bouge à l'ouverture de la popup
		document.getElementById("logo_acv").addEventListener("click", function(){
		document.getElementById('popup').style.display = "none";
		document.getElementById('defaut').style.display = "block";
		if(map.getZoom() < 8){
		if (document.getElementById('sidebar').classList.contains('collapsed')) {
		sidebar.open('home');}
		else {map.panTo([46.5, -3],{duration: 0.5 });}
		}
		});
		
		document.getElementById("close").addEventListener("click", function(){
		if(map.getZoom() < 8){
		if (document.getElementById('sidebar').classList.contains('collapsed') && map.getZoom() < 8) {
		map.panTo([46.5, 2],{duration: 0.5 });}
		else {map.panTo([46.5, -3],{duration: 0.5 });}
		}
		}); 

		document.getElementById("bouton-int-nat").addEventListener("click", function(event){
			if (event.stopPropagation) {event.stopPropagation();}
			document.getElementById('bouton-int-reg').setAttribute("class", "bouton");
			document.getElementById('bouton-int-nat').setAttribute("class", "bouton_on");
			document.getElementById('bouton-int-nat-val').setAttribute("class", "bouton");
			document.getElementById('bouton-int-nat-titre').setAttribute("class", "bouton");
			if (map.hasLayer(NPNRU_reg)) {map.removeLayer(NPNRU_reg); };
			if (map.hasLayer(NPNRU_nat_val)) {map.removeLayer(NPNRU_nat_val); };
			if (map.hasLayer(NPNRU_nat)==false) {map.addLayer(NPNRU_nat); }
		}); 
		
		document.getElementById("bouton-int-nat-titre").addEventListener("click", function(event){
			event.stopPropagation();
			document.getElementById('bouton-int-nat').setAttribute("class", "bouton_on");
			document.getElementById('bouton-int-reg').setAttribute("class", "bouton");
			document.getElementById('bouton-int-nat-val').setAttribute("class", "bouton_on");
			document.getElementById('bouton-int-nat-titre').setAttribute("class", "bouton_on");
			if (map.hasLayer(NPNRU_reg)) {map.removeLayer(NPNRU_reg); };
			if (map.hasLayer(NPNRU_nat)==false) {map.addLayer(NPNRU_nat);};
			if (map.hasLayer(NPNRU_nat_val)==false) {map.addLayer(NPNRU_nat_val);};
		}); 
		
		document.getElementById("bouton-int-reg").addEventListener("click", function(event){
			event.stopPropagation();
			document.getElementById('bouton-int-nat').setAttribute("class", "bouton");
			document.getElementById('bouton-int-reg').setAttribute("class", "bouton_on");
			document.getElementById('bouton-int-nat-val').setAttribute("class", "bouton");
			document.getElementById('bouton-int-nat-titre').setAttribute("class", "bouton");
			if (map.hasLayer(NPNRU_nat)) {map.removeLayer(NPNRU_nat); };
			if (map.hasLayer(NPNRU_nat_val)) {map.removeLayer(NPNRU_nat_val); };
			if (map.hasLayer(NPNRU_reg)==false) {map.addLayer(NPNRU_reg); }
		}); 
		
		document.getElementById("bouton-int-nat-val").addEventListener("click", function(event){
			event.stopPropagation();
			document.getElementById('bouton-int-nat-val').setAttribute("class", "bouton_on");
			document.getElementById('bouton-int-nat').setAttribute("class", "bouton");
			document.getElementById('bouton-int-reg').setAttribute("class", "bouton");
			document.getElementById('bouton-int-nat-titre').setAttribute("class", "bouton");
			if (map.hasLayer(NPNRU_nat)) {map.removeLayer(NPNRU_nat);};
			if (map.hasLayer(NPNRU_reg)) {map.removeLayer(NPNRU_reg);};
			if (map.hasLayer(NPNRU_nat_val)==false) {map.addLayer(NPNRU_nat_val); }
		});
		
		//Barre de recherche
		var Recherche = L.layerGroup([NPNRU_nat,NPNRU_nat_val,NPNRU_reg]);
		
		L.control.search({
			layer: Recherche,
			initial: false,
			zoom: 10,
			propertyName: 'NOM_QP'
		})
		.addTo(map);


   </script>
	
</body>



</html>
